/*                                                                            */
/* (c) Texas Instruments 2006-2009, All rights reserved.                      */
/*                                                                            */
/*                                                                            */
/* File:            TMS470MSF542.gel                                        */
/* Versions:        1.0                                                       */
/*                                                                            */
/* Note: This GEL file is provided as an example and might be used for        */
/*       software development for the TMS470MSF542 microcontroller. Before  */
/*       usage it is recommended to check if the file provides the            */
/*       functionality expected.                                              */
/*                                                                            */
/*                                                                            */

/*----------------------------------------------------------------------------*/
/* Definitions - Memory Map Specifiers                                        */
#define FLASH   0
#define RAM     1

/*----------------------------------------------------------------------------*/
/* Definitions - Text Format Specifiers                                       */
#define BLACK   0
#define BLUE    1
#define RED     2 

/*----------------------------------------------------------------------------*/
/* Definitions - Memory Switch                                                */
#define STARTED 0
#define COMPL   1

/*----------------------------------------------------------------------------*/
/* Global Variables - Default Memory Map                                      */
unsigned int MemoryMap  = FLASH;

/*----------------------------------------------------------------------------*/
/* Global Variables - Memory Switch                                           */
unsigned int MemSwitchState = COMPL;

/*----------------------------------------------------------------------------*/
/* Function - StartUp()                                                       */
/*                                                                            */
StartUp(){

} /* StartUp() */

/*----------------------------------------------------------------------------*/
/* Function - OnResetDetected()                                               */
/*                                                                            */
OnResetDetected(){

    if(MemSwitchState == COMPL){
    
        memmap(FLASH);
        MemoryMap = FLASH;
        GEL_TextOut("\tMemory Map Setup for Flash @ Address 0x0 due to System Reset\n",,,,,);
    }
    
    if(MemSwitchState == STARTED)
     
        MemSwitchState == COMPL;
    }
/*----------------------------------------------------------------------------*/
/* Function - OnTargetConnect()                                               */
/*                                                                            */
OnTargetConnect(){

    if(MemoryMap == FLASH){
        memmap(FLASH);
        GEL_TextOut("\tMemory Map Setup for Flash @ Address 0x0",,,,,);
    }    
    if(MemoryMap == RAM){
        memmap(RAM);
        GEL_TextOut("\tMemory Map Setup for RAM @ Address 0x0.",,,,,);
        GEL_TextOut("\tFor Debugging Only!",,,,,);
    }   
} /* OnTargetConnect() */

/*----------------------------------------------------------------------------*/
/* Function - memmap(memSel, extMem)                                          */
/*                                                                            */
memmap(memSel){

    GEL_MapOff();
    GEL_MapReset();	

    /* Flash / RAM Definition */
    if(memSel == FLASH){

        /* Flash Definition */
        GEL_MapAdd(0x00000000, 0, 0x000A0000, 1, 0); /* Internal Flash ()     */
        GEL_MapAdd(0x00400000, 0, 0x00050000, 1, 0); /* Internal Flash ECC    */
        GEL_MapAdd(0x08000000, 0, 0x00010000, 1, 1); /* Internal RAM          */
        GEL_MapAdd(0x08400000, 0, 0x00010000, 1, 1); /* Internal RAM ECC      */
        GEL_MapAdd(0xFE000000, 0, 0x01000000, 1, 1); /* CRC/PSA               */
    }

    if(memSel == RAM){

        /* RAM Definition */
        GEL_MapAdd(0x00000000, 0, 0x00010000, 1, 1); /* Internal RAM          */
        GEL_MapAdd(0x00400000, 0, 0x00010000, 1, 1); /* Internal RAM ECC      */
        GEL_MapAdd(0x08000000, 0, 0x000A0000, 1, 0); /* Internal Flash ()     */
        GEL_MapAdd(0x08400000, 0, 0x00050000, 1, 0); /* Internal Flash ECC    */
        GEL_MapAdd(0xFE000000, 0, 0x01000000, 1, 1); /* CRC/PSA               */
    }

    /* Peripheral Register Definition */
    GEL_MapAdd(0xFFF7F800, 0, 0x00000200, 1, 1); /* SPI3       - PS01         */
    GEL_MapAdd(0xFFF7F600, 0, 0x00000200, 1, 1); /* MIBSPI2       - PS02         */
    GEL_MapAdd(0xFFF7F400, 0, 0x00000200, 1, 1); /* MIBSPI1    - PS02         */
    GEL_MapAdd(0xFFF7E400, 0, 0x00000100, 1, 1); /* LIN        - PS06         */
    GEL_MapAdd(0xFFF7E500, 0, 0x00000100, 1, 1); /* SCI        - PS06         */
    GEL_MapAdd(0xFFF7DE00, 0, 0x00000200, 1, 1); /* DCAN2      - PS08         */
    GEL_MapAdd(0xFFF7DC00, 0, 0x00000200, 1, 1); /* DCAN1      - PS08         */
    GEL_MapAdd(0xFFF7C000, 0, 0x00000200, 1, 1); /* MIBADC1    - PS15         */
    GEL_MapAdd(0xFFF7BC00, 0, 0x00000100, 1, 1); /* GIO        - PS16         */
    GEL_MapAdd(0xFFF7B800, 0, 0x00000100, 1, 1); /* HET       - PS17         */
    
    
    /* Peripheral Memory */
    GEL_MapAdd(0xFF0C0000, 0, 0x00020000, 1, 1); /* MibSPI2 RAM    - PS07     */
    GEL_MapAdd(0xFF0E0000, 0, 0x00020000, 1, 1); /* MibSPI1 RAM    - PS07     */
    GEL_MapAdd(0xFF1C0000, 0, 0x00020000, 1, 1); /* CAN2 RAM       - PS14     */
    GEL_MapAdd(0xFF1E0000, 0, 0x00020000, 1, 1); /* CAN1 RAM       - PS15     */
    GEL_MapAdd(0xFF3E0000, 0, 0x00020000, 1, 1); /* MIBADC1 RAM    - PS31     */
    GEL_MapAdd(0xFF460000, 0, 0x00020000, 1, 1); /* HET RAM       - PS35     */
    
    /* System Peripheral Register */
    GEL_MapAdd(0xFE000000, 0, 0x01000000, 1, 1); /* CRC                       */
    GEL_MapAdd(0xE000E000, 0, 0x00001000, 1, 1); /* VIC       */   	
    GEL_MapAdd(0xFFF87000, 0, 0x00001000, 1, 1); /* Flash Wrapper Register    */
    GEL_MapAdd(0xFFFFE000, 0, 0x00000100, 1, 1); /* PCR Register              */
    GEL_MapAdd(0xFFFFE100, 0, 0x00000100, 1, 1); /* SYS2 Register      */
    GEL_MapAdd(0xFFFFE400, 0, 0x00000100, 1, 1); /* LBIST                     */
    GEL_MapAdd(0xFFFFF500, 0, 0x00000100, 1, 1); /* ESM                       */
    GEL_MapAdd(0xFFFFF900, 0, 0x00000100, 1, 1); /* RAM ECC odd               */	
    GEL_MapAdd(0xFFFFFC00, 0, 0x00000100, 1, 1); /* RTI Register              */    
    GEL_MapAdd(0xFFFFFE00, 0, 0x00000100, 1, 1); /* VIM Register              */
    GEL_MapAdd(0xFFFFFF00, 0, 0x00000100, 1, 1); /* System Register           */

    GEL_MapOn();

} /* Function - memmap(memSel, extMem) */

/*----------------------------------------------------------------------------*/
/* Function - swap_mem(memSel)                                                */
/*                                                                            */
swap_mem(memSel){
    
    GEL_TextOut("NOTES:\n\tThe Flash/RAM memory adresses of the device will be switched.");
    
    MemSwitchState = STARTED;
    
    if(memSel == RAM){

        memmap(RAM);
        MemoryMap = RAM;
        *(int *) 0xffffffc4 = 0x05050505;        
    }

    if(memSel == FLASH){

        memmap(FLASH);
        MemoryMap = FLASH;
        *(int *) 0xffffffc4 = 0x0A0A0A0A;        
    }
    
    MemSwitchState = COMPL;
    
    GEL_TextOut("\tMemory swap is done.");
    
    
} /* swap_mem(memSel) */

/*----------------------------------------------------------------------------*/
/* MenuItem - "TMS470MSF542 Memory Map Setup"                                */
/*                                                                            */
menuitem "TMS470MSF542 Memory Map Setup";

    hotmenu CCS_MemMap_FLASH_at_0x0(){

        memmap(FLASH);
        GEL_TextOut("\tMemory Map Setup for Flash @ Address 0x0",,,,,);
        
    }

    hotmenu CCS_MemMap_RAM_at_0x0(){
    
        memmap(RAM);
        GEL_TextOut("\tMemory Map Setup for RAM @ Address 0x0.",,,,,);
        GEL_TextOut("\tFor Debugging Only!",,,,,);

    }

/*----------------------------------------------------------------------------*/
/* MenuItem - "TMS470MSF542 Memory Switch"                                   */
/*                                                                            */
menuitem "TMS470MSF542 Memory Switch";

    hotmenu Target_Flash_to_0x0(){

        swap_mem(FLASH);
    }

    hotmenu Target_RAM_to_0x0(){
    
        swap_mem(RAM);
    }
